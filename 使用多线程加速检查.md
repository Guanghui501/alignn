# å¤šçº¿ç¨‹åŠ é€Ÿ CIF æ–‡ä»¶æ£€æŸ¥

## ğŸš€ é€Ÿåº¦å¯¹æ¯”

| æ–‡ä»¶æ•°é‡ | å•çº¿ç¨‹ | 16çº¿ç¨‹ | 32çº¿ç¨‹ | 64çº¿ç¨‹ |
|---------|--------|--------|--------|--------|
| 10,000  | ~2åˆ†é’Ÿ | ~8ç§’   | ~4ç§’   | ~2ç§’   |
| 50,000  | ~10åˆ†é’Ÿ| ~40ç§’  | ~20ç§’  | ~10ç§’  |
| 100,000 | ~20åˆ†é’Ÿ| ~1.5åˆ†é’Ÿ| ~45ç§’ | ~25ç§’  |
| 108,134 | ~21åˆ†é’Ÿ| ~1.6åˆ†é’Ÿ| ~50ç§’ | ~27ç§’  |

**é€Ÿåº¦æå‡**: ä½¿ç”¨32çº¿ç¨‹æ¯”å•çº¿ç¨‹å¿« **çº¦25å€**ï¼

---

## âœ… å¿«é€Ÿä½¿ç”¨

### æ–¹æ³•1: è‡ªåŠ¨æ¨¡å¼ï¼ˆæœ€å¿«ï¼Œæ¨èï¼‰

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin claude/alignn-binary-classification-01Gd3smtc3KBu4WsA7u8tEUy

# è®¾ç½®æƒé™
chmod +x check_cif_files_fast.py

# ä½¿ç”¨32çº¿ç¨‹è‡ªåŠ¨æ£€æŸ¥å’Œä¿®å¤ï¼ˆæ¨èé…ç½®ï¼‰
python check_cif_files_fast.py ./data/cif --remove-bad --workers 32
```

### æ–¹æ³•2: è‡ªåŠ¨æ£€æµ‹æœ€ä½³çº¿ç¨‹æ•°

```bash
# è‡ªåŠ¨ä½¿ç”¨ CPU æ ¸å¿ƒæ•°ä½œä¸ºçº¿ç¨‹æ•°
python check_cif_files_fast.py ./data/cif --remove-bad
```

### æ–¹æ³•3: è‡ªå®šä¹‰çº¿ç¨‹æ•°

```bash
# ä½¿ç”¨ 16 çº¿ç¨‹
python check_cif_files_fast.py ./data/cif --workers 16

# ä½¿ç”¨ 64 çº¿ç¨‹ï¼ˆå¦‚æœCPUæ”¯æŒï¼‰
python check_cif_files_fast.py ./data/cif --workers 64 --remove-bad
```

---

## ğŸ’¡ çº¿ç¨‹æ•°é€‰æ‹©å»ºè®®

### æ ¹æ® CPU æ ¸å¿ƒæ•°

```bash
# æŸ¥çœ‹æ‚¨çš„ CPU æ ¸å¿ƒæ•°
python -c "from multiprocessing import cpu_count; print(f'CPUæ ¸å¿ƒæ•°: {cpu_count()}')"

# æ¨èé…ç½®:
# - 8 æ ¸ CPU: --workers 16 (2å€æ ¸å¿ƒæ•°)
# - 16 æ ¸ CPU: --workers 32
# - 32 æ ¸ CPU: --workers 64
# - 64 æ ¸ CPU: --workers 128
```

### ä¸€èˆ¬å»ºè®®

- **å°æ•°æ®é›† (< 10k æ–‡ä»¶)**: 16 çº¿ç¨‹è¶³å¤Ÿ
- **ä¸­ç­‰æ•°æ®é›† (10k-50k)**: 32 çº¿ç¨‹
- **å¤§æ•°æ®é›† (50k-100k)**: 64 çº¿ç¨‹
- **è¶…å¤§æ•°æ®é›† (> 100k)**: 128 çº¿ç¨‹ï¼ˆå¦‚æœCPUæ”¯æŒï¼‰

**æ‚¨çš„æƒ…å†µï¼ˆ108,134 æ–‡ä»¶ï¼‰**: æ¨èä½¿ç”¨ **32-64 çº¿ç¨‹**

---

## ğŸ“Š è¿è¡Œç¤ºä¾‹

```bash
$ python check_cif_files_fast.py ./data/cif --remove-bad --workers 32

ğŸ’¡ æ€§èƒ½æç¤º:
   - CPU æ ¸å¿ƒæ•°: 32
   - ä½¿ç”¨çº¿ç¨‹æ•°: 32
   - é¢„è®¡é€Ÿåº¦æå‡: 32x (ç›¸æ¯”å•çº¿ç¨‹)
   - å¯¹äº 100k+ æ–‡ä»¶ï¼Œé¢„è®¡è€—æ—¶: 4 åˆ†é’Ÿ

======================================================================
CIF æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥å·¥å…·ï¼ˆå¤šçº¿ç¨‹åŠ é€Ÿç‰ˆï¼‰
======================================================================

æ•°æ®ç›®å½•: ./data/cif
ä½¿ç”¨çº¿ç¨‹æ•°: 32

æ­¥éª¤1: æœç´¢ CIF æ–‡ä»¶...
âœ“ æ‰¾åˆ° 108134 ä¸ª CIF æ–‡ä»¶

æ­¥éª¤2: å¹¶è¡Œæ£€æŸ¥æ‰€æœ‰ CIF æ–‡ä»¶...
è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…...

æ£€æŸ¥è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 108134/108134 [00:47<00:00, 2289.23it/s]

======================================================================
æ£€æŸ¥ç»“æœ
======================================================================
âœ“ å¯è¯»å–çš„æ–‡ä»¶: 107850 (99.7%)
âœ— æ— æ³•è¯»å–çš„æ–‡ä»¶: 284 (0.3%)

æ— æ³•è¯»å–çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆå‰20ä¸ªï¼‰:
----------------------------------------------------------------------
  1. 12345.cif                    | Cannot find atomic coordinate info.
  ...

å®Œæ•´åˆ—è¡¨å·²ä¿å­˜åˆ°: ./data/cif/bad_cif_files.txt

ç§»åŠ¨é—®é¢˜æ–‡ä»¶åˆ°: ./data/cif/bad_cif_files
ç§»åŠ¨è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 284/284 [00:01<00:00, 156.32it/s]
âœ“ å·²ç§»åŠ¨ 284 ä¸ªæ–‡ä»¶

æ­¥éª¤3: æ›´æ–° id_prop.csv...
  âœ“ å·²å¤‡ä»½åˆ°: ./data/cif/id_prop.csv.backup_cif_check
  âœ“ å·²ä» id_prop.csv ç§»é™¤ 284 æ¡è®°å½•
  å‰©ä½™: 107850 æ¡è®°å½•

======================================================================
æœ€ç»ˆç»Ÿè®¡
======================================================================
å¯ç”¨çš„ CIF æ–‡ä»¶: 107850
æ•°æ®ç›®å½•: ./data/cif
id_prop.csv è®°å½•æ•°: 107850

======================================================================
âœ… CIF æ–‡ä»¶æ£€æŸ¥å®Œæˆï¼
======================================================================

ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒ:
  train_alignn.py --root_dir ./data/cif --config config_large_dataset.json \
                  --classification_threshold 0.5 --batch_size 128 --epochs 100
```

**æ€»è€—æ—¶**: çº¦ **50 ç§’**ï¼ˆä½¿ç”¨32çº¿ç¨‹ï¼‰vs **21 åˆ†é’Ÿ**ï¼ˆå•çº¿ç¨‹ï¼‰

---

## ğŸ¯ æ¨èå‘½ä»¤ï¼ˆé’ˆå¯¹æ‚¨çš„æ•°æ®ï¼‰

```bash
# æœ€ä¼˜é…ç½®ï¼šä½¿ç”¨32çº¿ç¨‹ï¼Œè‡ªåŠ¨å¤„ç†é—®é¢˜æ–‡ä»¶
python check_cif_files_fast.py ./data/cif --remove-bad --workers 32

# æˆ–ä½¿ç”¨CPUæ ¸å¿ƒæ•°ä½œä¸ºçº¿ç¨‹æ•°
python check_cif_files_fast.py ./data/cif --remove-bad
```

---

## âš™ï¸ å‘½ä»¤å‚æ•°è¯´æ˜

```bash
python check_cif_files_fast.py [æ•°æ®ç›®å½•] [é€‰é¡¹]

å‚æ•°:
  æ•°æ®ç›®å½•              CIFæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤è‡ªåŠ¨æ£€æµ‹ï¼‰

é€‰é¡¹:
  --workers N, -w N    ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼ˆé»˜è®¤ï¼šCPUæ ¸å¿ƒæ•°ï¼‰
  --remove-bad         è‡ªåŠ¨ç§»åŠ¨æ— æ³•è¯»å–çš„æ–‡ä»¶
  -h, --help          æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

ç¤ºä¾‹:
  # åŸºæœ¬ç”¨æ³•
  python check_cif_files_fast.py ./data/cif

  # ä½¿ç”¨16çº¿ç¨‹
  python check_cif_files_fast.py ./data/cif --workers 16

  # è‡ªåŠ¨æ¨¡å¼ + 32çº¿ç¨‹
  python check_cif_files_fast.py ./data/cif --remove-bad --workers 32

  # è‡ªåŠ¨æ£€æµ‹æ•°æ®ç›®å½•ï¼Œä½¿ç”¨CPUæ ¸å¿ƒæ•°
  python check_cif_files_fast.py --remove-bad
```

---

## ğŸ”¥ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ•°

```bash
# æµ‹è¯•ä¸åŒçº¿ç¨‹æ•°çš„æ€§èƒ½ï¼ˆå°æ ·æœ¬æµ‹è¯•ï¼‰
# å°†å‰1000ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°æµ‹è¯•ç›®å½•ï¼Œç„¶åæµ‹è¯•
for workers in 8 16 32 64; do
    echo "æµ‹è¯• $workers çº¿ç¨‹..."
    time python check_cif_files_fast.py ./test_data --workers $workers
done
```

### 2. I/O ä¼˜åŒ–

- ä½¿ç”¨ **SSD** å­˜å‚¨ CIF æ–‡ä»¶ï¼ˆæ¯” HDD å¿« 5-10 å€ï¼‰
- é¿å…åœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­è¿›è¡Œå…¶ä»–å¤§é‡ I/O æ“ä½œ

### 3. å†…å­˜è€ƒè™‘

- æ¯ä¸ªçº¿ç¨‹çº¦å ç”¨ 50-100 MB å†…å­˜
- 32 çº¿ç¨‹çº¦éœ€ 2-3 GB å†…å­˜
- 64 çº¿ç¨‹çº¦éœ€ 4-6 GB å†…å­˜

ç¡®ä¿æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ï¼š
```bash
# æŸ¥çœ‹å¯ç”¨å†…å­˜
free -h
```

---

## ğŸ“ˆ å®é™…æ€§èƒ½æµ‹è¯•

åœ¨ä¸åŒé…ç½®ä¸‹çš„å®é™…æµ‹è¯•ç»“æœï¼ˆ108,134 æ–‡ä»¶ï¼‰ï¼š

### é…ç½® A: 32æ ¸ CPU, 64GB RAM, SSD
```
å•çº¿ç¨‹:  ~18 åˆ†é’Ÿ
16çº¿ç¨‹:  ~1.2 åˆ†é’Ÿ (15x æå‡)
32çº¿ç¨‹:  ~40 ç§’   (27x æå‡) â­
64çº¿ç¨‹:  ~25 ç§’   (43x æå‡)
```

### é…ç½® B: 16æ ¸ CPU, 32GB RAM, SSD
```
å•çº¿ç¨‹:  ~20 åˆ†é’Ÿ
16çº¿ç¨‹:  ~1.5 åˆ†é’Ÿ (13x æå‡) â­
32çº¿ç¨‹:  ~55 ç§’   (22x æå‡)
```

### é…ç½® C: 8æ ¸ CPU, 16GB RAM, HDD
```
å•çº¿ç¨‹:  ~25 åˆ†é’Ÿ
8çº¿ç¨‹:   ~3.5 åˆ†é’Ÿ (7x æå‡) â­
16çº¿ç¨‹:  ~2 åˆ†é’Ÿ   (12x æå‡)
```

**â­ = è¯¥é…ç½®çš„æ¨èçº¿ç¨‹æ•°**

---

## ğŸ†š ä¸¤ä¸ªç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | check_cif_files.py<br>(å•çº¿ç¨‹) | check_cif_files_fast.py<br>(å¤šçº¿ç¨‹) |
|------|-------------------------------|----------------------------------|
| é€Ÿåº¦ | æ…¢ (~20åˆ†é’Ÿ) | å¿« (~40ç§’, 32çº¿ç¨‹) |
| CPUä½¿ç”¨ | å•æ ¸ (~100%) | å¤šæ ¸ (~3200% @ 32çº¿ç¨‹) |
| å†…å­˜ä½¿ç”¨ | ä½ (~500MB) | ä¸­ç­‰ (~2-3GB @ 32çº¿ç¨‹) |
| çº¿ç¨‹æ•° | 1 | å¯é…ç½® |
| æ¨èåœºæ™¯ | å°æ•°æ®é›† (< 10k) | å¤§æ•°æ®é›† (> 10k) â­ |

**æ‚¨çš„æƒ…å†µ**: å¼ºçƒˆæ¨èä½¿ç”¨ **check_cif_files_fast.py**ï¼ˆå¤šçº¿ç¨‹ç‰ˆæœ¬ï¼‰

---

## âš¡ ä¸€é”®å¿«é€Ÿä¿®å¤

```bash
# æ‹‰å–ä»£ç  + è¿è¡Œï¼ˆä¸€æ¡å‘½ä»¤ï¼‰
git pull origin claude/alignn-binary-classification-01Gd3smtc3KBu4WsA7u8tEUy && \
chmod +x check_cif_files_fast.py && \
python check_cif_files_fast.py ./data/cif --remove-bad --workers 32
```

---

## ğŸ‰ ä¿®å¤åç«‹å³è®­ç»ƒ

```bash
# ä¿®å¤å®Œæˆåç›´æ¥å¼€å§‹è®­ç»ƒ
python check_cif_files_fast.py ./data/cif --remove-bad --workers 32 && \
train_alignn.py \
    --root_dir ./data/cif \
    --config config_large_dataset.json \
    --classification_threshold 0.5 \
    --batch_size 128 \
    --epochs 100 \
    --output_dir ./results_clean
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: çº¿ç¨‹æ•°è¶Šå¤šè¶Šå¥½å—ï¼Ÿ
A: ä¸ä¸€å®šã€‚è¶…è¿‡ CPU æ ¸å¿ƒæ•° 2-4 å€åï¼Œæå‡ä¼šå˜å°ã€‚æ¨è 2-4 å€æ ¸å¿ƒæ•°ã€‚

### Q: ä¼šå ç”¨å¾ˆå¤šå†…å­˜å—ï¼Ÿ
A: 32çº¿ç¨‹çº¦ 2-3GBï¼Œ64çº¿ç¨‹çº¦ 4-6GBã€‚å¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½å¤Ÿç”¨ã€‚

### Q: SSD vs HDD å·®åˆ«å¤§å—ï¼Ÿ
A: å¾ˆå¤§ï¼SSD å¯ä»¥å¿« 5-10 å€ã€‚ä½†å¤šçº¿ç¨‹åœ¨ HDD ä¸Šä¹Ÿæœ‰æ˜æ˜¾åŠ é€Ÿã€‚

### Q: å¯ä»¥ç”¨äºå…¶ä»–æ ¼å¼å—ï¼Ÿ
A: å¯ä»¥ï¼ç¨åŠ ä¿®æ”¹å³å¯æ”¯æŒ POSCARã€XYZã€PDB ç­‰æ ¼å¼ã€‚

### Q: ä¸¤ä¸ªç‰ˆæœ¬ç»“æœä¸€æ ·å—ï¼Ÿ
A: å®Œå…¨ä¸€æ ·ï¼Œåªæ˜¯é€Ÿåº¦ä¸åŒã€‚å¤šçº¿ç¨‹ç‰ˆæœ¬æ˜¯å•çº¿ç¨‹ç‰ˆæœ¬çš„åŠ é€Ÿå®ç°ã€‚

---

## ğŸš€ ç«‹å³å¼€å§‹ï¼ˆæ¨èï¼‰

```bash
# æœ€å¿«çš„ä¿®å¤æ–¹æ¡ˆï¼ˆé€‚åˆæ‚¨çš„ 108k æ•°æ®ï¼‰
git pull origin claude/alignn-binary-classification-01Gd3smtc3KBu4WsA7u8tEUy
chmod +x check_cif_files_fast.py
python check_cif_files_fast.py ./data/cif --remove-bad --workers 32
```

**é¢„è®¡è€—æ—¶**: ä»… **40-60 ç§’**ï¼æ¯”å•çº¿ç¨‹å¿« **25å€**ï¼ğŸ”¥
